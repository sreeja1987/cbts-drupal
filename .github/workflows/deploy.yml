name: Mirror to Pantheon
on:
  push:
    branches:
      - master  # Matches your branch

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0 

      # THIS STEP IS REQUIRED FOR RSA KEYS
      - name: Install SSH Key
        uses: shimataro/ssh-key-action@v2
        with:
          key: ${{ secrets.PANTHEON_SSH_KEY }}
          known_hosts: "placeholder"
          config: |
            Host *.drush.in
              StrictHostKeyChecking no
              PubkeyAcceptedAlgorithms +ssh-rsa
              HostkeyAlgorithms +ssh-rsa
              Port 2222

      - name: Push to Pantheon
        uses: pixta-dev/repository-mirroring-action@v1
        with:
          target_repo_url: ssh://codeserver.dev.a800e0e6-2a59-4f50-ae1b-490939258925@codeserver.dev.a800e0e6-2a59-4f50-ae1b-490939258925.drush.in:2222/~/repository.git
          ssh_private_key: ${{ secrets.PANTHEON_SSH_KEY }}